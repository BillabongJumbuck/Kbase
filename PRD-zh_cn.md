# 产品需求文档 (PRD) - Kbase

## 1. 项目概述

**Kbase** 是一个轻量级、基于终端（TUI）的命令知识库工具。它的设计初衷是帮助开发者快速存储、检索和复习常用命令。该项目采用“本地优先 (Local-First)”策略，使用 YAML 文件进行数据持久化，支持跨平台运行（Linux, Windows/WSL, Android/Termux），并具备毫秒级启动和极速模糊搜索的能力。

## 2. 核心价值

- **速度 (Speed):** 毫秒级启动，零延迟搜索。
- **极简 (Minimalism):** 严格专注于“查”和“记”，摒弃复杂的社交功能或强制云同步。
- **工作流整合 (Workflow):** 完全在终端环境内操作，支持基于 Git 的数据同步（由用户管理），并能无缝调用系统默认编辑器 (`$EDITOR`)。

## 3. 技术栈

- **编程语言:** Go (Golang)
- **UI 框架:** `charmbracelet/bubbletea` (TUI 交互核心)
- **样式库:** `charmbracelet/lipgloss` (UI 美化)
- **数据解析:** `gopkg.in/yaml.v3`
- **剪贴板支持:** `github.com/atotto/clipboard` 或 `golang.design/x/clipboard`

## 4. 数据结构 (Data Schema)

数据将存储在用户主目录下的 `~/.config/kbase/commands.yaml` (或用户指定的其他路径)。

### 4.1 YAML 结构定义

YAML

```
- cmd: "kubectl get pods"             # [必填] 命令主体
  desc: "列出当前命名空间下的所有 Pods"  # [必填] 简短说明
  tags:                               # [选填] 用于分类和搜索权重的标签
    - "k8s"
    - "container"
  platform:                           # [选填] 平台限制。若为空，则在所有平台显示
    - "linux"
    - "darwin"                        # 仅在 Linux 和 macOS 显示，Win 下隐藏
  examples:                           # [选填] 具体用法的代码块
    - "kubectl get pods -n kube-system -o wide"
    - "kubectl get pods --watch"
```

## 5. 功能需求详情

### 5.1 启动与加载

- **初始化:** 程序启动时，自动读取默认路径的 YAML 文件。如果文件不存在，自动创建一个包含示例数据的模板文件。
- **平台过滤:** 加载数据时，检测当前操作系统（`runtime.GOOS`）。如果某条记录的 `platform` 字段不为空且不包含当前系统，则在列表中隐藏该条目。

### 5.2 列表与搜索 (主界面)

- **UI 布局:**
  - **顶部:** 搜索输入框。
  - **中部:** 可滚动的命令列表（左侧显示 `cmd`，右侧灰色显示 `desc`）。
  - **底部:** 状态栏（显示快捷键提示）。
- **模糊搜索:** 列表内容随用户输入实时过滤。搜索范围涵盖 `cmd` (命令), `desc` (描述), 和 `tags` (标签)。

### 5.3 详情展示

- **交互:** 当光标选中某条目时，如果该条目包含 `examples` 字段，应在界面中（宽屏模式下在右侧，窄屏模式下在下方）展示详细示例。
- **文本截断:** 列表视图中过长的 `desc` 文本应被截断，完整内容在详情视图中可见。

### 5.4 剪贴板操作 (复制)

- **触发:** 用户按下 `Ctrl+c`。
- **动作:** 将当前选中条目的 `cmd` 字段内容写入系统剪贴板。
- **反馈:** 底部状态栏短暂变绿并显示 "Copied!" (已复制)，随后恢复原状。
- **注意:** 由于 `Ctrl+c` 通常是终端的“中断/退出”信号，程序必须拦截 `SIGINT` 或在 Bubble Tea 中覆盖默认按键映射，以执行复制操作而非退出。

### 5.5 编辑功能

- **触发:** 用户按下 `e` 键。
- **流程:**
  1. **挂起 (Suspend):** TUI 暂停渲染循环，释放终端控制权。
  2. **外部进程:** 应用调用 `$EDITOR` 环境变量定义的编辑器（如 vim, nano, code）打开 `commands.yaml` 文件。
  3. **恢复 (Resume):** 用户关闭编辑器后，TUI 恢复运行。
  4. **重载 (Reload):** 应用自动重新解析 YAML 文件并刷新列表，以立即反映修改。

## 6. 交互设计与快捷键 (Keybindings)

| **按键**         | **动作**          | **说明**                                              |
| ---------------- | ----------------- | ----------------------------------------------------- |
| `Ctrl+c`         | **复制 (Copy)**   | 复制当前选中的命令到剪贴板。                          |
| `Esc` / `Ctrl+q` | **退出 (Quit)**   | 退出应用程序（替代了常规的 Ctrl+c 退出功能）。        |
| `e`              | **编辑 (Edit)**   | 使用默认 `$EDITOR` 打开源 YAML 文件。                 |
| `Enter`          | **无动作 / 展开** | (可选) 展开查看详情或不做任何操作（取决于实现偏好）。 |
| `↑` / `k`        | **上移**          | 在列表中向上导航。                                    |
| `↓` / `j`        | **下移**          | 在列表中向下导航。                                    |
| `/`              | **搜索**          | 聚焦到搜索栏（如果尚未聚焦）。                        |

## 7. 异常处理

- **YAML 语法错误:** 如果编辑后的 YAML 文件格式损坏，应用**严禁崩溃**。应显示一个红色的错误视图 (`ErrorView`) 提示“解析失败 (Parsing Failed)”，并允许用户再次按 `e` 键重新编辑以修复文件。
- **剪贴板失效:** 在无头模式 (Headless) 或纯 SSH 环境中，如果无法访问剪贴板，状态栏应提示“Clipboard not supported (不支持剪贴板)”，并作为后备方案，在程序退出时将命令打印到标准输出 (`stdout`)。